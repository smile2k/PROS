<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:WPFTool.Controls"
                    xmlns:local="clr-namespace:WPFTool.Helpers">
    
    <local:ArcStartPointConverter x:Key="ArcStartPointConverter" />
    <local:ArcEndPointConverter x:Key="ArcEndPointConverter" />
    <local:HalfConverter x:Key="HalfConverter" />
    <local:AngleToIsLargeArcConverter x:Key="ProgressToIsLargeArcConverter" />
    <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    <local:ProgressToAngleConverter x:Key="ProgressToAngleConverter" />
    
    <Style TargetType="{x:Type controls:WpCircleProgressBar}">

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type controls:WpCircleProgressBar}">
                    
                    <Grid>
                        <Ellipse StrokeThickness="{Binding StrokeThickness, RelativeSource={RelativeSource TemplatedParent}}"
                                 Stroke="#ddd"
                                 HorizontalAlignment="Stretch"
                                 VerticalAlignment="Stretch" />

                        <Path x:Name="SpinnerPath"
                              StrokeThickness="{Binding Path=StrokeThickness, RelativeSource={RelativeSource TemplatedParent}}"
                              StrokeStartLineCap="Round"
                              StrokeEndLineCap="Round"
                              RenderTransformOrigin="0.5,0.5">
                            <Path.Stroke>
                                <LinearGradientBrush StartPoint="0,0"
                                                     EndPoint="1,0">
                                    <GradientStop Color="DodgerBlue"
                                                  Offset="0.0" />
                                    <GradientStop Color="BlueViolet"
                                                  Offset="1.0" />
                                </LinearGradientBrush>

                            </Path.Stroke>
                            <Path.Data>
                                <PathGeometry>
                                    <PathFigure IsClosed="False">
                                        <PathFigure.StartPoint>
                                            <MultiBinding Converter="{StaticResource ArcStartPointConverter}">
                                                <Binding RelativeSource="{RelativeSource AncestorType=controls:WpCircleProgressBar}"
                                                         Path="ActualWidth" />
                                                <Binding RelativeSource="{RelativeSource AncestorType=controls:WpCircleProgressBar}"
                                                         Path="ActualHeight" />
                                                <Binding RelativeSource="{RelativeSource TemplatedParent}"
                                                         Path="StrokeThickness" />
                                            </MultiBinding>
                                        </PathFigure.StartPoint>
                                        <ArcSegment IsLargeArc="{Binding Path=Angle, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ProgressToIsLargeArcConverter}}"
                                                    SweepDirection="Clockwise">
                                            <ArcSegment.Size>
                                                <MultiBinding Converter="{StaticResource HalfConverter}">
                                                    <Binding Path="ActualWidth"
                                                             RelativeSource="{RelativeSource TemplatedParent}" />
                                                    <Binding Path="ActualHeight"
                                                             RelativeSource="{RelativeSource TemplatedParent}" />
                                                    <Binding Path="StrokeThickness"
                                                             RelativeSource="{RelativeSource TemplatedParent}" />
                                                </MultiBinding>
                                            </ArcSegment.Size>
                                            <ArcSegment.Point>
                                                <MultiBinding Converter="{StaticResource ArcEndPointConverter}">
                                                    <Binding RelativeSource="{RelativeSource AncestorType=controls:WpCircleProgressBar}"
                                                             Path="ActualWidth" />
                                                    <Binding RelativeSource="{RelativeSource AncestorType=controls:WpCircleProgressBar}"
                                                             Path="ActualHeight" />
                                                    <Binding RelativeSource="{RelativeSource TemplatedParent}"
                                                             Path="StrokeThickness" />
                                                    <Binding RelativeSource="{RelativeSource AncestorType=controls:WpCircleProgressBar}"
                                                             Path="Angle" />

                                                </MultiBinding>
                                            </ArcSegment.Point>

                                        </ArcSegment>
                                    </PathFigure>
                                </PathGeometry>
                            </Path.Data>
                            <Path.RenderTransform>
                                <RotateTransform x:Name="rotateTransform"
                                                 Angle="0" />
                            </Path.RenderTransform>
                            <!--<Path.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation Storyboard.TargetName="rotateTransform"
                                                             Storyboard.TargetProperty="Angle"
                                                             From="0"
                                                             To="360"
                                                             Duration="0:0:1"
                                                             RepeatBehavior="Forever" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Path.Triggers>-->
                        </Path>
                        <TextBlock Text="{Binding Progress, RelativeSource={RelativeSource TemplatedParent}, StringFormat={}{0:0}%}"
                                   Visibility="{Binding IsTextVisible, RelativeSource={RelativeSource AncestorType=controls:WpCircleProgressBar}, Converter={StaticResource BoolToVisibilityConverter}}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="Black" />
                        
                    </Grid>

                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>